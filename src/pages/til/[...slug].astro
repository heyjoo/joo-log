---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection, render } from 'astro:content';

const base = import.meta.env.BASE_URL.replace(/\/$/, '');

export async function getStaticPaths() {
  const tils = await getCollection('til');
  return tils.map((til) => ({
    params: { slug: til.slug },
    props: { til },
  }));
}

const { til } = Astro.props;
const { title, date } = til.data;
const { Content } = await render(til);

const formattedDate = date.toLocaleDateString('ko-KR', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});
---

<BaseLayout title={title} description={`TIL: ${title}`}>
  <article>
    <header class="mb-8">
      <div class="flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400 mb-2">
        <span class="px-2 py-0.5 bg-primary-100 dark:bg-primary-900 text-primary-700 dark:text-primary-300 rounded text-xs font-medium">
          TIL
        </span>
        <time datetime={date.toISOString()}>{formattedDate}</time>
      </div>
      <h1 class="text-3xl font-bold mb-3">{title}</h1>
    </header>
    <div class="prose">
      <Content />
    </div>
  </article>
  <nav class="mt-12 pt-8 border-t border-gray-200 dark:border-gray-700">
    <a href={`${base}/til`} class="text-primary-600 dark:text-primary-400 hover:underline">
      &larr; TIL 목록으로
    </a>
  </nav>
</BaseLayout>
